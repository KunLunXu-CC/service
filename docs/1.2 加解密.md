# 加解密

## 使用 node-rsa 生成秘钥

```js
const NodeRSA = require('node-rsa');
// 生成秘钥
const key = new NodeRSA({ bits: 512 });
// 如果需要则设置填充方式
// key.setOptions({ encryptionScheme: 'pkcs1' });
// 导出公、私钥
const private = key.exportKey('private');
const public = key.exportKey('public');
console.log(private);
console.log(public);



```

## 前端使用生成的公钥进行加密

返回 base64 类型密文数据

```js
// 公钥
const key = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoWATfIA97hbj8rbtZBPo
T+gR7iK5IV1weysfOSJcE1CoqJt9bePHkQeBLj1cWbM9m5wvkB2WQN3YCKDHzqVd
9pQ6AHOkx7cCxMrjBm8QEV7ACU+NN/2MBRmOHiuRq+PdDfV+V6b/RYCn8hMmVkTU
SGGyYkSou8bigBkCwv56x7I0AkdSkCQ1oYgWqfbW9Ms6QTIxmeCO2sI4mr/ABYDi
oVHY0hIBM9nR8Dcb4u/faXRh2nwhBgpSm09CXaKzFv2WmYxWgul3i6zlzAhziO6s
ogueSeM9qOIZhWn2uAd8pHsK3KHUA91EPphQvR+ReFJV6J1t5a7Cy5+I9sz62jIz
JwIDAQAB
-----END PUBLIC KEY-----`;
```

```js
// 数据加密后结果
// 111111 => J42+61sYiWVZmfoT7X7N1Genl16aNR7zAeMpLRt88O5V2bBNCD6R4dELgtHS8b6mtQBQtJpiKjFloNTpM7BBuddWI2SQwsEnu9Sy/ygl3shnG+aUqd2vS4rhEnHzVwaVsdeOSNZwnC5v0I9897biZ1ImZbIx3vl5VgDLzDRj0mULucHTqca+5PK8lnXcG53p8WYfp0iGxzLr2WJsAK9Imblh8nFQDHLJp9V1RjBiA9EHTszBjjKZCsBpgq0rKzf7Xi1rwj6SxS9oF2XbFTP9QJ+afp6TL+27xKIrXQQf2B85UiCU4uB2JxudYFPU33uy2dfgx71xxuUtGmsamH3oDg==

// 123456 => ZIl0bK42PkH9j+X0VfR7pxhMlIssuQyHm2twAUxnMDHuSLL71wcDU9ox7R6AiI7Rll7/Mosz7OgMxWZLBu6C1RTXfEkJbSFKCQBjz2st3/bhxe4xgDcwmmgNtGbXOsz2HWC3zwqvOx85WVCDTm8hPOn8Vmf1TEO3KOZHNSQ61AXCeceGTm73FzRRmXdm/Oy6ySfzHzXoN0tKAc1yI8KgYoUeYQ2hoyzjHuEpZGps4T+a+055mVbsafPTV49huiB+6fAaVhPM2Tu/4krbyHBoBfPAaRVqv70tuaSsKPSpUh0sRdd7Qb9SYU7Y+Yb0IhAClCGztdUoux2PQZFcGGGHxw==
```

## 后端使用生成的私钥进行解密

```js
const NodeRSA = require('node-rsa');
// 私钥
const key = `-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAoWATfIA97hbj8rbtZBPoT+gR7iK5IV1weysfOSJcE1CoqJt9
bePHkQeBLj1cWbM9m5wvkB2WQN3YCKDHzqVd9pQ6AHOkx7cCxMrjBm8QEV7ACU+N
N/2MBRmOHiuRq+PdDfV+V6b/RYCn8hMmVkTUSGGyYkSou8bigBkCwv56x7I0AkdS
kCQ1oYgWqfbW9Ms6QTIxmeCO2sI4mr/ABYDioVHY0hIBM9nR8Dcb4u/faXRh2nwh
BgpSm09CXaKzFv2WmYxWgul3i6zlzAhziO6sogueSeM9qOIZhWn2uAd8pHsK3KHU
A91EPphQvR+ReFJV6J1t5a7Cy5+I9sz62jIzJwIDAQABAoIBAQCdplZjEoVtyz71
Jm/TjP8u0PBzS8jAJ6BzMzVVg5Of6vRZg02NxTB5JnO00I0ftFNDadmtWLootJEQ
HMIVxsd81GG1f0RDNy6lQe93oZh436+LaQP05uWbNdP49WdiHUEfGe1LhAFtzLpF
ax/Qt30LGSZDif+tMiakLcrc4+7ellOXecvjOTJQCbfvgZs6lBft5uAax7ovUSky
mZlvO7A6ix50CePkRHlVmC3Fvr4zD4hV0m2EPH7ywBGI67d6G73K3NDNG51Y+LCw
3D6sFxu4UJga7+mtltCpMXPL4rrrrFVcGoaNzHfjFLEHGEQaGZIdoVEFpwEUrPa7
GPf7k97BAoGBANGePWJnEbqfAHO0HZVujGCjodJMem+tuhn4drLunU7PLmgZCofC
Y2QaeJjwhu7FaVQIYGkfWvdjlWij3GrYGFxmSw/eWXtFgq4OBJn6ENYi4pLyOlAq
tVLWLWPJ2d9lykm7JrCrnBTCZjxhgxOi9InaSdndr9jWcbrBZjlxWNSLAoGBAMUV
IoYBER1odaCezZn0WdaBMgQAgBuxaqwyotNIpE6re8mGW9vo31PJ1q5UuRYPPnok
h8KvuLdQbLXUyI1ApFL26kkxtTWsmS1vl7t0vcEx7I2lvhXW+L0WjKbmy3rVCXwp
s89oLC26RBq1VR0PbxXzkh7Eb95dBRI3AIJwYgNVAoGAJvkt3pLdR/5yHhEaAwOX
1Av4dVpE1WjOli+NGj2lP9bjgPVO8Ojig+UsEPt/ivtnVvlru3/Z8O8yA0+cFr1w
4hUe1ad4qaPF5Uiz8FD/OmEoETw6PVeDeRBbRhdsi82oK8dBLU3q6i0uxwE2VrtQ
jiTo4DoIjN9qK9fzgrChXHsCgYBu+LWVyuf+LSF+rayLccFcPScShc2cykuMZn60
hYSvH3P2R4dVzkxh+5a8VsxZFYBSeltPTm6uGcT8pbG/h5R/erT1Pd4ROPyPTvSb
AuMN87SFFbxww7kPj7DnEbGlmmta1IiA0uF9ZhKPD2e7k0MzkxDF7konZS1D0mCh
EfK+eQKBgQC6k1BVf70is1K5bONx8D8h7gyNNvZOK64Gm8cG14xyEAyK3BAQ+fai
P5Y1kKxJJes27BGzwBqz76/7gartSlKDwdjb5Qs56qGWbNroezkPuSTsrFZ4XNaW
yMbrzb5dz0AGlLuGymRO3qSu4vZkeBi2Pf3Rh60iJmuXY6YQbB9y2g==
-----END RSA PRIVATE KEY-----`;
// 传入私钥创建私钥对象
const privateKey = new NodeRSA(key);

// 对数据进行解密
const decrypted = key.decrypt(encrypted, 'utf8');
```

## 前端使用 jsencrypt 进行加密，后端使用 node-rsa 进行解密时遇到问题错误

```shell
"message": "Error during decryption (probably incorrect key). Original error: Error: error:04099079:rsa routines:RSA_padding_check_PKCS1_OAEP_mgf1:oaep decoding error"
```

- 原因

主要是因为秘钥格式(填充方案)设置不同：
node-rsa 使用 pkcs1_oaep 格式进行加密和解密
jsencrypt 使用 pkcs1

- 解决办法

node-rsa 通过设置选项 encryptionScheme 修改秘钥格式(填充方案)

```js
// 传入私钥创建私钥对象
const privateKey = new NodeRSA(key);
privateKey.setOptions({ encryptionScheme: 'pkcs1' });
```

- 补充如果使用 node-rsa 生成秘钥记得设置秘钥格式(填充方案)

```js
key.setOptions({ encryptionScheme: 'pkcs1' });
```
